"use strict";(()=>{var e={};e.id=811,e.ids=[811],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},245:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>_,staticGenerationAsyncStorage:()=>p});var a={};r.r(a),r.d(a,{GET:()=>l});var s=r(9303),o=r(8716),i=r(670),n=r(7857),u=r(7070);async function l(e){try{let t;let r=e.headers.get("authorization"),a=process.env.ADMIN_API_KEY;if(!a)return u.NextResponse.json({error:"Admin API key not configured"},{status:500});if(!r||r!==`Bearer ${a}`)return u.NextResponse.json({error:"Unauthorized - Invalid admin API key"},{status:401});let s=function(){let e="https://migwxtovyxygobpmhuqk.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Missing Supabase environment variables");return(0,n.eI)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}(),{data:o,error:i}=await s.rpc("get_daily_stats");if(i){let{data:e,error:r}=await s.from("food_entries").select("date_time, nutritional_data, user_id");if(r)throw r;let a=new Map;e?.forEach(e=>{let t=new Date(e.date_time).toISOString().split("T")[0],r=parseFloat(e.nutritional_data?.calories||"0");a.has(t)||a.set(t,{date:t,total_entries:0,unique_users:new Set,total_calories:0,entry_count:0});let s=a.get(t);s.total_entries++,s.unique_users.add(e.user_id),s.total_calories+=r,s.entry_count++}),t=Array.from(a.values()).map(e=>({date:e.date,total_entries:e.total_entries,unique_users:e.unique_users.size,avg_calories:e.entry_count>0?e.total_calories/e.entry_count:0})).sort((e,t)=>t.date.localeCompare(e.date))}else t=o;let{data:l,error:d}=await s.from("food_entries").select("meal_type");if(d)throw d;let c=new Map,p=0;l?.forEach(e=>{e.meal_type&&(c.set(e.meal_type,(c.get(e.meal_type)||0)+1),p++)});let _=Array.from(c.entries()).map(([e,t])=>({meal_type:e,count:t,percentage:p>0?Math.round(t/p*1e4)/100:0})).sort((e,t)=>t.count-e.count),{data:m,error:f}=await s.from("food_entries").select("nutritional_data");if(f)throw f;let h=0,g=0,y=0,v=0,w=0;m?.forEach(e=>{let t=e.nutritional_data||{};h+=parseFloat(t.calories||"0"),g+=parseFloat(t.protein||"0"),y+=parseFloat(t.carbohydrates||"0"),v+=parseFloat(t.fat||"0"),w++});let x={avg_calories:w>0?h/w:0,avg_protein:w>0?g/w:0,avg_carbs:w>0?y/w:0,avg_fat:w>0?v/w:0},{count:A,error:E}=await s.from("food_entries").select("*",{count:"exact",head:!0});if(E)throw E;let{data:R,error:S}=await s.from("food_entries").select("user_id");if(S)throw S;let b=new Set(R?.map(e=>e.user_id)||[]);return u.NextResponse.json({summary:{total_entries:A||0,unique_users:b.size},daily_stats:t,meal_type_distribution:_,average_nutrition:x})}catch(e){return console.error("Error fetching admin statistics:",e),u.NextResponse.json({error:e.message||"Failed to fetch statistics"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/statistics/route",pathname:"/api/admin/statistics",filename:"route",bundlePath:"app/api/admin/statistics/route"},resolvedPagePath:"/Users/odet/websites/AFIRD-new/src/app/api/admin/statistics/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:_}=d,m="/api/admin/statistics/route";function f(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:p})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,564],()=>r(245));module.exports=a})();