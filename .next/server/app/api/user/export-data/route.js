"use strict";(()=>{var t={};t.id=11,t.ids=[11],t.modules={2934:t=>{t.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:t=>{t.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:t=>{t.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2450:(t,e,i)=>{i.r(e),i.d(e,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>p});var a={};i.r(a),i.d(a,{GET:()=>u});var r=i(9303),n=i(8716),s=i(670),o=i(5655),m=i(7070),l=i(9781);async function u(t){try{let e=await (0,o.e)(),{data:{user:i}}=await e.auth.getUser();if(!i)return m.NextResponse.json({error:"Unauthorized"},{status:401});let a=t.nextUrl.searchParams.get("format")||"json",r=await (0,l.vM)();if("csv"===a){let t=r.map(t=>[t.id,t.date_time,t.meal_type||"",t.nutritional_data.calories||"",t.nutritional_data.protein||"",t.nutritional_data.carbohydrates||"",t.nutritional_data.fat||"",t.nutritional_data.fiber||"",t.nutritional_data.sugar||"",t.nutritional_data.sodium||"",t.image_url]),e=["ID,Date/Time,Meal Type,Calories,Protein (g),Carbohydrates (g),Fat (g),Fiber (g),Sugar (g),Sodium (mg),Image URL",...t.map(t=>t.map(t=>`"${t}"`).join(","))].join("\n");return new m.NextResponse(e,{headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="food-entries-${new Date().toISOString().split("T")[0]}.csv"`}})}{let t=JSON.stringify({entries:r},null,2);return new m.NextResponse(t,{headers:{"Content-Type":"application/json","Content-Disposition":`attachment; filename="food-entries-${new Date().toISOString().split("T")[0]}.json"`}})}}catch(t){return console.error("Error exporting data:",t),m.NextResponse.json({error:t.message||"Failed to export data"},{status:500})}}let d=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/user/export-data/route",pathname:"/api/user/export-data",filename:"route",bundlePath:"app/api/user/export-data/route"},resolvedPagePath:"/Users/odet/websites/AFIRD-new/src/app/api/user/export-data/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:v}=d,g="/api/user/export-data/route";function f(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:p})}},5655:(t,e,i)=>{i.d(e,{e:()=>n});var a=i(7721),r=i(1615);async function n(){let t=await (0,r.cookies)();return(0,a.createServerClient)("https://migwxtovyxygobpmhuqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ3d4dG92eXh5Z29icG1odXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5MzM2MDgsImV4cCI6MjA4MTUwOTYwOH0.05AiLm3KJCGQnMsLv1ffezeISbzCOeXVrmRUtlC4ysg",{cookies:{getAll:()=>t.getAll(),setAll(e){try{e.forEach(({name:e,value:i,options:a})=>t.set(e,i,a))}catch{}}}})}},9781:(t,e,i)=>{i.d(e,{$w:()=>o,Hp:()=>m,vM:()=>n,_p:()=>s,xP:()=>r});var a=i(5655);async function r(t){let e=await (0,a.e)(),{data:{user:i}}=await e.auth.getUser();if(!i)throw Error("User not authenticated");let{data:r,error:n}=await e.from("food_entries").insert({user_id:i.id,image_url:t.imageUrl,image_storage_path:t.imageStoragePath,meal_type:t.mealType||null,date_time:t.dateTime.toISOString(),nutritional_data:t.nutritionalData}).select().single();if(n)throw Error(`Failed to save food entry: ${n.message}`);return r}async function n(t){let e=await (0,a.e)(),{data:{user:i}}=await e.auth.getUser();if(!i)throw Error("User not authenticated");let r=e.from("food_entries").select("*").eq("user_id",i.id).order("date_time",{ascending:!1});t?.startDate&&(r=r.gte("date_time",t.startDate.toISOString())),t?.endDate&&(r=r.lte("date_time",t.endDate.toISOString())),t?.mealType&&(r=r.eq("meal_type",t.mealType)),t?.limit&&(r=r.limit(t.limit));let{data:n,error:s}=await r;if(s)throw Error(`Failed to fetch food entries: ${s.message}`);return n||[]}async function s(t){let e=await (0,a.e)(),{data:{user:i}}=await e.auth.getUser();if(!i)throw Error("User not authenticated");let{data:r,error:n}=await e.from("food_entries").select("*").eq("id",t).eq("user_id",i.id).single();if(n){if("PGRST116"===n.code)return null;throw Error(`Failed to fetch food entry: ${n.message}`)}return r}async function o(t){let e=await (0,a.e)(),{data:{user:i}}=await e.auth.getUser();if(!i)throw Error("User not authenticated");let{error:r}=await e.from("food_entries").delete().eq("id",t).eq("user_id",i.id);if(r)throw Error(`Failed to delete food entry: ${r.message}`)}async function m(t){let e=await n({startDate:new Date(t.setHours(0,0,0,0)),endDate:new Date(t.setHours(23,59,59,999))}),i=function(t){let e={calories:0,protein:0,carbohydrates:0,fat:0,fiber:0,sugar:0,sodium:0,vitamins:{},minerals:{}};return t.forEach(t=>{if(void 0!==t.calories&&(e.calories=(e.calories||0)+t.calories),void 0!==t.protein&&(e.protein=(e.protein||0)+t.protein),void 0!==t.carbohydrates&&(e.carbohydrates=(e.carbohydrates||0)+t.carbohydrates),void 0!==t.fat&&(e.fat=(e.fat||0)+t.fat),void 0!==t.fiber&&(e.fiber=(e.fiber||0)+t.fiber),void 0!==t.sugar&&(e.sugar=(e.sugar||0)+t.sugar),void 0!==t.sodium&&(e.sodium=(e.sodium||0)+t.sodium),t.vitamins){e.vitamins||(e.vitamins={});let i=t.vitamins;e.vitamins.vitaminA=(e.vitamins.vitaminA||0)+(i.vitaminA||0),e.vitamins.vitaminB1=(e.vitamins.vitaminB1||0)+(i.vitaminB1||0),e.vitamins.vitaminB2=(e.vitamins.vitaminB2||0)+(i.vitaminB2||0),e.vitamins.vitaminB3=(e.vitamins.vitaminB3||0)+(i.vitaminB3||0),e.vitamins.vitaminB6=(e.vitamins.vitaminB6||0)+(i.vitaminB6||0),e.vitamins.vitaminB12=(e.vitamins.vitaminB12||0)+(i.vitaminB12||0),e.vitamins.vitaminC=(e.vitamins.vitaminC||0)+(i.vitaminC||0),e.vitamins.vitaminD=(e.vitamins.vitaminD||0)+(i.vitaminD||0),e.vitamins.vitaminE=(e.vitamins.vitaminE||0)+(i.vitaminE||0),e.vitamins.vitaminK=(e.vitamins.vitaminK||0)+(i.vitaminK||0),e.vitamins.folate=(e.vitamins.folate||0)+(i.folate||0)}if(t.minerals){e.minerals||(e.minerals={});let i=t.minerals;e.minerals.calcium=(e.minerals.calcium||0)+(i.calcium||0),e.minerals.iron=(e.minerals.iron||0)+(i.iron||0),e.minerals.magnesium=(e.minerals.magnesium||0)+(i.magnesium||0),e.minerals.phosphorus=(e.minerals.phosphorus||0)+(i.phosphorus||0),e.minerals.potassium=(e.minerals.potassium||0)+(i.potassium||0),e.minerals.zinc=(e.minerals.zinc||0)+(i.zinc||0),e.minerals.copper=(e.minerals.copper||0)+(i.copper||0),e.minerals.manganese=(e.minerals.manganese||0)+(i.manganese||0),e.minerals.selenium=(e.minerals.selenium||0)+(i.selenium||0)}}),e}(e.map(t=>t.nutritional_data));return{date:t.toISOString().split("T")[0],totalEntries:e.length,totals:i,entries:e}}}};var e=require("../../../../webpack-runtime.js");e.C(t);var i=t=>e(e.s=t),a=e.X(0,[276,564,702],()=>i(2450));module.exports=a})();