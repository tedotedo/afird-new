"use strict";(()=>{var e={};e.id=614,e.ids=[614],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9372:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var a={};i.r(a),i.d(a,{GET:()=>c,POST:()=>u});var r=i(9303),n=i(8716),s=i(670),o=i(5655),m=i(7070),l=i(9781),d=i(56);async function u(e){try{let t=await (0,o.e)(),{data:{user:i}}=await t.auth.getUser();if(!i)return m.NextResponse.json({error:"Unauthorized"},{status:401});let a=await e.formData(),r=a.get("image"),n=a.get("nutritionalData"),s=a.get("mealType"),u=a.get("dateTime");if(!r||!n||!u)return m.NextResponse.json({error:"Image, nutritional data, and dateTime are required"},{status:400});let c=JSON.parse(n),p=crypto.randomUUID(),f=await (0,o.e)(),{url:g,path:v}=await (0,d.Q)(f,r,i.id,p),h=await (0,l.xP)({imageUrl:g,imageStoragePath:v,mealType:s||void 0,dateTime:new Date(u),nutritionalData:c});return m.NextResponse.json({entry:h},{status:201})}catch(e){return console.error("Error creating food entry:",e),m.NextResponse.json({error:e.message||"Failed to create food entry"},{status:500})}}async function c(e){try{let t=await (0,o.e)(),{data:{user:i}}=await t.auth.getUser();if(!i)return m.NextResponse.json({error:"Unauthorized"},{status:401});let a=e.nextUrl.searchParams,r=a.get("startDate"),n=a.get("endDate"),s=a.get("mealType"),d=a.get("limit"),u=await (0,l.vM)({startDate:r?new Date(r):void 0,endDate:n?new Date(n):void 0,mealType:s,limit:d?parseInt(d):void 0});return m.NextResponse.json({entries:u})}catch(e){return console.error("Error fetching food entries:",e),m.NextResponse.json({error:e.message||"Failed to fetch food entries"},{status:500})}}let p=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/food-entries/route",pathname:"/api/food-entries",filename:"route",bundlePath:"app/api/food-entries/route"},resolvedPagePath:"/Users/odet/websites/AFIRD-new/src/app/api/food-entries/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:v}=p,h="/api/food-entries/route";function w(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}},5655:(e,t,i)=>{i.d(t,{e:()=>n});var a=i(7721),r=i(1615);async function n(){let e=await (0,r.cookies)();return(0,a.createServerClient)("https://migwxtovyxygobpmhuqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ3d4dG92eXh5Z29icG1odXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5MzM2MDgsImV4cCI6MjA4MTUwOTYwOH0.05AiLm3KJCGQnMsLv1ffezeISbzCOeXVrmRUtlC4ysg",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:i,options:a})=>e.set(t,i,a))}catch{}}}})}},9781:(e,t,i)=>{i.d(t,{$w:()=>o,Hp:()=>m,vM:()=>n,_p:()=>s,xP:()=>r});var a=i(5655);async function r(e){let t=await (0,a.e)(),{data:{user:i}}=await t.auth.getUser();if(!i)throw Error("User not authenticated");let{data:r,error:n}=await t.from("food_entries").insert({user_id:i.id,image_url:e.imageUrl,image_storage_path:e.imageStoragePath,meal_type:e.mealType||null,date_time:e.dateTime.toISOString(),nutritional_data:e.nutritionalData}).select().single();if(n)throw Error(`Failed to save food entry: ${n.message}`);return r}async function n(e){let t=await (0,a.e)(),{data:{user:i}}=await t.auth.getUser();if(!i)throw Error("User not authenticated");let r=t.from("food_entries").select("*").eq("user_id",i.id).order("date_time",{ascending:!1});e?.startDate&&(r=r.gte("date_time",e.startDate.toISOString())),e?.endDate&&(r=r.lte("date_time",e.endDate.toISOString())),e?.mealType&&(r=r.eq("meal_type",e.mealType)),e?.limit&&(r=r.limit(e.limit));let{data:n,error:s}=await r;if(s)throw Error(`Failed to fetch food entries: ${s.message}`);return n||[]}async function s(e){let t=await (0,a.e)(),{data:{user:i}}=await t.auth.getUser();if(!i)throw Error("User not authenticated");let{data:r,error:n}=await t.from("food_entries").select("*").eq("id",e).eq("user_id",i.id).single();if(n){if("PGRST116"===n.code)return null;throw Error(`Failed to fetch food entry: ${n.message}`)}return r}async function o(e){let t=await (0,a.e)(),{data:{user:i}}=await t.auth.getUser();if(!i)throw Error("User not authenticated");let{error:r}=await t.from("food_entries").delete().eq("id",e).eq("user_id",i.id);if(r)throw Error(`Failed to delete food entry: ${r.message}`)}async function m(e){let t=await n({startDate:new Date(e.setHours(0,0,0,0)),endDate:new Date(e.setHours(23,59,59,999))}),i=function(e){let t={calories:0,protein:0,carbohydrates:0,fat:0,fiber:0,sugar:0,sodium:0,vitamins:{},minerals:{}};return e.forEach(e=>{if(void 0!==e.calories&&(t.calories=(t.calories||0)+e.calories),void 0!==e.protein&&(t.protein=(t.protein||0)+e.protein),void 0!==e.carbohydrates&&(t.carbohydrates=(t.carbohydrates||0)+e.carbohydrates),void 0!==e.fat&&(t.fat=(t.fat||0)+e.fat),void 0!==e.fiber&&(t.fiber=(t.fiber||0)+e.fiber),void 0!==e.sugar&&(t.sugar=(t.sugar||0)+e.sugar),void 0!==e.sodium&&(t.sodium=(t.sodium||0)+e.sodium),e.vitamins){t.vitamins||(t.vitamins={});let i=e.vitamins;t.vitamins.vitaminA=(t.vitamins.vitaminA||0)+(i.vitaminA||0),t.vitamins.vitaminB1=(t.vitamins.vitaminB1||0)+(i.vitaminB1||0),t.vitamins.vitaminB2=(t.vitamins.vitaminB2||0)+(i.vitaminB2||0),t.vitamins.vitaminB3=(t.vitamins.vitaminB3||0)+(i.vitaminB3||0),t.vitamins.vitaminB6=(t.vitamins.vitaminB6||0)+(i.vitaminB6||0),t.vitamins.vitaminB12=(t.vitamins.vitaminB12||0)+(i.vitaminB12||0),t.vitamins.vitaminC=(t.vitamins.vitaminC||0)+(i.vitaminC||0),t.vitamins.vitaminD=(t.vitamins.vitaminD||0)+(i.vitaminD||0),t.vitamins.vitaminE=(t.vitamins.vitaminE||0)+(i.vitaminE||0),t.vitamins.vitaminK=(t.vitamins.vitaminK||0)+(i.vitaminK||0),t.vitamins.folate=(t.vitamins.folate||0)+(i.folate||0)}if(e.minerals){t.minerals||(t.minerals={});let i=e.minerals;t.minerals.calcium=(t.minerals.calcium||0)+(i.calcium||0),t.minerals.iron=(t.minerals.iron||0)+(i.iron||0),t.minerals.magnesium=(t.minerals.magnesium||0)+(i.magnesium||0),t.minerals.phosphorus=(t.minerals.phosphorus||0)+(i.phosphorus||0),t.minerals.potassium=(t.minerals.potassium||0)+(i.potassium||0),t.minerals.zinc=(t.minerals.zinc||0)+(i.zinc||0),t.minerals.copper=(t.minerals.copper||0)+(i.copper||0),t.minerals.manganese=(t.minerals.manganese||0)+(i.manganese||0),t.minerals.selenium=(t.minerals.selenium||0)+(i.selenium||0)}}),t}(t.map(e=>e.nutritional_data));return{date:e.toISOString().split("T")[0],totalEntries:t.length,totals:i,entries:t}}},56:(e,t,i)=>{async function a(e,t,i,a){let r="undefined"!=typeof File&&t instanceof File,n=r?t.name.split(".").pop():"jpg",s=`${a}.${n}`,o=`${i}/${s}`,m=await t.arrayBuffer(),{data:l,error:d}=await e.storage.from("food-images").upload(o,m,{contentType:r?t.type:"image/jpeg",upsert:!1});if(d){let e=d.message||"Unknown error",t=e.toLowerCase();if(t.includes("quota")||t.includes("storage quota")||t.includes("insufficient"))throw Error("Storage quota exceeded. Please check your Supabase storage limits or contact support.");throw Error(`Failed to upload image: ${e}`)}let{data:u}=e.storage.from("food-images").getPublicUrl(o);return{url:u.publicUrl,path:o}}async function r(e,t){let{error:i}=await e.storage.from("food-images").remove([t]);if(i)throw Error(`Failed to delete image: ${i.message}`)}i.d(t,{E:()=>r,Q:()=>a})}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[276,564,702],()=>i(9372));module.exports=a})();