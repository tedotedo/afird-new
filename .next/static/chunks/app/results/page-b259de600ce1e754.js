(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[87],{7535:function(e,t,a){Promise.resolve().then(a.bind(a,893)),Promise.resolve().then(a.bind(a,6331))},893:function(e,t,a){"use strict";a.d(t,{default:function(){return r}});var s=a(7437),i=a(2265),l=a(9376),n=a(5632);function r(e){let{children:t,redirectTo:a="/login"}=e,{user:r,loading:o}=(0,n.a)(),c=(0,l.useRouter)();return((0,i.useEffect)(()=>{o||r||c.push(a)},[r,o,c,a]),o)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):r?(0,s.jsx)(s.Fragment,{children:t}):null}},4036:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(7437);function i(e){let{title:t,value:a,unit:i,color:l="#3498db"}=e;return null==a?null:(0,s.jsxs)("div",{className:"flex items-center py-3 border-b border-gray-200 last:border-0",children:[(0,s.jsx)("div",{className:"w-1 h-10 rounded mr-4",style:{backgroundColor:l}}),(0,s.jsxs)("div",{className:"flex-1 flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-base text-gray-800",children:t}),(0,s.jsxs)("span",{className:"text-base font-semibold text-gray-800",children:[a.toFixed(a<1?2:0)," ",i]})]})]})}function l(e){let{nutritionalData:t}=e,a="#3498db",l="#9b59b6";return(0,s.jsxs)("div",{className:"w-full space-y-5",children:[void 0!==t.calories&&(0,s.jsx)("div",{className:"bg-white rounded-xl p-5 shadow-lg",children:(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsx)("div",{className:"w-1 h-12 rounded mr-4",style:{backgroundColor:"#e74c3c"}}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-base text-gray-600 mb-1",children:"Calories"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-gray-800",children:[t.calories.toFixed(0)," kcal"]})]})]})}),(0,s.jsxs)("div",{className:"space-y-0",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-3 px-1",children:"Macronutrients"}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow-lg",children:[(0,s.jsx)(i,{title:"Protein",value:t.protein,unit:"g",color:a}),(0,s.jsx)(i,{title:"Carbohydrates",value:t.carbohydrates,unit:"g",color:a}),(0,s.jsx)(i,{title:"Fat",value:t.fat,unit:"g",color:a})]})]}),(0,s.jsxs)("div",{className:"space-y-0",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-3 px-1",children:"Other Nutrients"}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow-lg",children:[(0,s.jsx)(i,{title:"Fiber",value:t.fiber,unit:"g",color:l}),(0,s.jsx)(i,{title:"Sugar",value:t.sugar,unit:"g",color:l}),(0,s.jsx)(i,{title:"Sodium",value:t.sodium,unit:"mg",color:l})]})]}),t.vitamins&&Object.values(t.vitamins).some(e=>null!=e)&&(0,s.jsxs)("div",{className:"space-y-0",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-3 px-1",children:"Vitamins"}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow-lg",children:[(0,s.jsx)(i,{title:"Vitamin A",value:t.vitamins.vitaminA,unit:"mcg RAE",color:"#f39c12"}),(0,s.jsx)(i,{title:"Vitamin B1 (Thiamine)",value:t.vitamins.vitaminB1,unit:"mg",color:"#f39c12"}),(0,s.jsx)(i,{title:"Vitamin B2 (Riboflavin)",value:t.vitamins.vitaminB2,unit:"mg",color:"#f39c12"}),(0,s.jsx)(i,{title:"Vitamin B3 (Niacin)",value:t.vitamins.vitaminB3,unit:"mg",color:"#f39c12"}),(0,s.jsx)(i,{title:"Vitamin B6",value:t.vitamins.vitaminB6,unit:"mg",color:"#f39c12"}),(0,s.jsx)(i,{title:"Vitamin B12",value:t.vitamins.vitaminB12,unit:"mcg",color:"#f39c12"}),(0,s.jsx)(i,{title:"Vitamin C",value:t.vitamins.vitaminC,unit:"mg",color:"#f39c12"}),(0,s.jsx)(i,{title:"Vitamin D",value:t.vitamins.vitaminD,unit:"mcg",color:"#f39c12"}),(0,s.jsx)(i,{title:"Vitamin E",value:t.vitamins.vitaminE,unit:"mg",color:"#f39c12"}),(0,s.jsx)(i,{title:"Vitamin K",value:t.vitamins.vitaminK,unit:"mcg",color:"#f39c12"}),(0,s.jsx)(i,{title:"Folate",value:t.vitamins.folate,unit:"mcg",color:"#f39c12"})]})]}),t.minerals&&Object.values(t.minerals).some(e=>null!=e)&&(0,s.jsxs)("div",{className:"space-y-0",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-3 px-1",children:"Minerals"}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow-lg",children:[(0,s.jsx)(i,{title:"Calcium",value:t.minerals.calcium,unit:"mg",color:"#16a085"}),(0,s.jsx)(i,{title:"Iron",value:t.minerals.iron,unit:"mg",color:"#16a085"}),(0,s.jsx)(i,{title:"Magnesium",value:t.minerals.magnesium,unit:"mg",color:"#16a085"}),(0,s.jsx)(i,{title:"Phosphorus",value:t.minerals.phosphorus,unit:"mg",color:"#16a085"}),(0,s.jsx)(i,{title:"Potassium",value:t.minerals.potassium,unit:"mg",color:"#16a085"}),(0,s.jsx)(i,{title:"Zinc",value:t.minerals.zinc,unit:"mg",color:"#16a085"}),(0,s.jsx)(i,{title:"Copper",value:t.minerals.copper,unit:"mg",color:"#16a085"}),(0,s.jsx)(i,{title:"Manganese",value:t.minerals.manganese,unit:"mg",color:"#16a085"}),(0,s.jsx)(i,{title:"Selenium",value:t.minerals.selenium,unit:"mcg",color:"#16a085"})]})]}),t.meal_type&&(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow flex items-center",children:[(0,s.jsx)("span",{className:"text-base text-gray-600 mr-2",children:"Meal Type:"}),(0,s.jsx)("span",{className:"text-base font-semibold text-gray-800 capitalize",children:t.meal_type})]}),t.food_items&&t.food_items.length>0&&(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow",children:[(0,s.jsx)("p",{className:"text-base font-semibold text-gray-800 mb-3",children:"Food Items:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:t.food_items.map((e,t)=>(0,s.jsx)("span",{className:"bg-gray-100 px-3 py-1.5 rounded-full text-sm text-gray-800",children:e},t))})]}),t.description&&(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 shadow",children:[(0,s.jsx)("p",{className:"text-base font-semibold text-gray-800 mb-2",children:"Description:"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 leading-relaxed",children:t.description})]})]})}a(2265)},5632:function(e,t,a){"use strict";a.d(t,{a:function(){return n}});var s=a(2265),i=a(4033),l=a(9376);function n(){let[e,t]=(0,s.useState)(null),[a,n]=(0,s.useState)(null),[r,o]=(0,s.useState)(!0),c=(0,l.useRouter)(),d=(0,i.createBrowserClient)("https://migwxtovyxygobpmhuqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ3d4dG92eXh5Z29icG1odXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5MzM2MDgsImV4cCI6MjA4MTUwOTYwOH0.05AiLm3KJCGQnMsLv1ffezeISbzCOeXVrmRUtlC4ysg");return(0,s.useEffect)(()=>{d.auth.getSession().then(e=>{var a;let{data:{session:s}}=e;n(s),t(null!==(a=null==s?void 0:s.user)&&void 0!==a?a:null),o(!1)});let{data:{subscription:e}}=d.auth.onAuthStateChange((e,a)=>{var s;n(a),t(null!==(s=null==a?void 0:a.user)&&void 0!==s?s:null),o(!1)});return()=>e.unsubscribe()},[d]),{user:e,session:a,loading:r,signUp:async(e,t)=>{let{data:a,error:s}=await d.auth.signUp({email:e,password:t});if(s)throw s;return a},signIn:async(e,t)=>{let{data:a,error:s}=await d.auth.signInWithPassword({email:e,password:t});if(s)throw s;return a},signOut:async()=>{let{error:e}=await d.auth.signOut();if(e)throw e;c.push("/login")},isAuthenticated:!!e}}},8404:function(e,t,a){"use strict";a.d(t,{J:function(){return i}});var s=a(2265);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{autoFetch:t=!0,...a}=e,[i,l]=(0,s.useState)([]),[n,r]=(0,s.useState)(t),[o,c]=(0,s.useState)(null),d=(0,s.useCallback)(async()=>{try{r(!0),c(null);let e=new URLSearchParams;a.startDate&&e.append("startDate",a.startDate.toISOString()),a.endDate&&e.append("endDate",a.endDate.toISOString()),a.mealType&&e.append("mealType",a.mealType),a.limit&&e.append("limit",a.limit.toString());let t=await fetch("/api/food-entries?".concat(e.toString()));if(!t.ok)throw Error("Failed to fetch entries");let s=await t.json();l(s.entries||[])}catch(e){c(e.message||"Failed to fetch entries")}finally{r(!1)}},[a.startDate,a.endDate,a.mealType,a.limit]);return(0,s.useEffect)(()=>{t&&d()},[t,d]),{entries:i,loading:n,error:o,fetchEntries:d,saveEntry:async(e,t,a,s)=>{try{r(!0),c(null);let i=new FormData;i.append("image",e),i.append("nutritionalData",JSON.stringify(t)),a&&i.append("mealType",a),i.append("dateTime",(s||new Date).toISOString());let n=await fetch("/api/food-entries",{method:"POST",body:i});if(!n.ok){let e=await n.json();throw Error(e.error||"Failed to save entry")}let o=(await n.json()).entry;return l(e=>[o,...e]),o}catch(e){throw c(e.message||"Failed to save entry"),e}finally{r(!1)}},deleteEntry:async e=>{try{r(!0),c(null);let t=await fetch("/api/food-entries/".concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to delete entry")}l(t=>t.filter(t=>t.id!==e))}catch(e){throw c(e.message||"Failed to delete entry"),e}finally{r(!1)}},refetch:d}}},6331:function(e,t,a){"use strict";a.d(t,{default:function(){return u}});var s=a(7437),i=a(2265),l=a(9376);function n(e){let{imageUri:t}=e;return(0,s.jsx)("div",{className:"w-full h-72 rounded-2xl overflow-hidden bg-gray-200 mb-5 shadow-lg",children:(0,s.jsx)("img",{src:t,alt:"Food",className:"w-full h-full object-cover"})})}var r=a(8057);function o(e){let{dateTime:t}=e;return(0,s.jsxs)("div",{className:"bg-gray-100 rounded-xl p-4 mb-5 text-center shadow",children:[(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-800",children:(0,r.o0)(t)}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:(0,r.SY)(t)})]})}var c=a(4036),d=a(8404);function u(){let e=(0,l.useRouter)(),[t,a]=(0,i.useState)(null),[r,u]=(0,i.useState)(null),[m,x]=(0,i.useState)(!1),[h,g]=(0,i.useState)(null),[f,v]=(0,i.useState)(!1),{saveEntry:p}=(0,d.J)({autoFetch:!1});(0,i.useEffect)(()=>{let t=sessionStorage.getItem("analysisResult"),s=sessionStorage.getItem("analysisImageFile");if(t)try{let e=JSON.parse(t);if(e.dateTime=new Date(e.dateTime),a(e),s){let e=JSON.parse(s);fetch(e.dataUrl).then(e=>e.blob()).then(t=>{let a=new File([t],e.name,{type:e.type});u(a)})}}catch(t){console.error("Error parsing stored result:",t),e.push("/")}else e.push("/")},[e]);let b=async()=>{if(!t||!r){g("Missing image or result data");return}x(!0),g(null),v(!1);try{await p(r,t.nutritionalData,t.nutritionalData.meal_type,t.dateTime),v(!0),setTimeout(()=>{sessionStorage.removeItem("analysisResult"),sessionStorage.removeItem("analysisImageFile"),e.push("/history")},1500)}catch(e){g(e.message||"Failed to save entry")}finally{x(!1)}};return t?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:[(0,s.jsx)("div",{className:"text-center mb-6",children:(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Analysis Results"})}),(0,s.jsx)(n,{imageUri:t.imageUri}),(0,s.jsx)(o,{dateTime:t.dateTime}),(0,s.jsx)(c.Z,{nutritionalData:t.nutritionalData}),f&&(0,s.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mt-4",children:"Entry saved successfully! Redirecting..."}),h&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mt-4",children:h}),(0,s.jsxs)("div",{className:"flex gap-4 mt-8",children:[(0,s.jsx)("button",{onClick:b,disabled:m||f||!r,className:"flex-1 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white font-semibold py-4 px-6 rounded-lg transition shadow-lg disabled:cursor-not-allowed",children:m?"Saving...":f?"Saved!":"Save Entry"}),(0,s.jsx)("button",{onClick:()=>{sessionStorage.removeItem("analysisResult"),sessionStorage.removeItem("analysisImageFile"),e.push("/")},disabled:m,className:"flex-1 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white font-semibold py-4 px-6 rounded-lg transition shadow-lg disabled:cursor-not-allowed",children:"Take Another Photo"})]})]})}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})}},8057:function(e,t,a){"use strict";a.d(t,{SY:function(){return n},o0:function(){return l}});var s=a(7868),i=a(4081);function l(e){return(0,s.Z)(e,"PPp")}function n(e){return(0,i.Z)(e,{addSuffix:!0})}}},function(e){e.O(0,[146,797,971,117,744],function(){return e(e.s=7535)}),_N_E=e.O()}]);