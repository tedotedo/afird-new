(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{846:function(e,t,n){Promise.resolve().then(n.bind(n,893)),Promise.resolve().then(n.bind(n,15))},893:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var i=n(7437),r=n(2265),a=n(9376),s=n(5632);function o(e){let{children:t,redirectTo:n="/login"}=e,{user:o,loading:l}=(0,s.a)(),c=(0,a.useRouter)();return((0,r.useEffect)(()=>{l||o||c.push(n)},[o,l,c,n]),l)?(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):o?(0,i.jsx)(i.Fragment,{children:t}):null}},5632:function(e,t,n){"use strict";n.d(t,{a:function(){return s}});var i=n(2265),r=n(4033),a=n(9376);function s(){let[e,t]=(0,i.useState)(null),[n,s]=(0,i.useState)(null),[o,l]=(0,i.useState)(!0),c=(0,a.useRouter)(),m=(0,r.createBrowserClient)("https://migwxtovyxygobpmhuqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pZ3d4dG92eXh5Z29icG1odXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5MzM2MDgsImV4cCI6MjA4MTUwOTYwOH0.05AiLm3KJCGQnMsLv1ffezeISbzCOeXVrmRUtlC4ysg");return(0,i.useEffect)(()=>{m.auth.getSession().then(e=>{var n;let{data:{session:i}}=e;s(i),t(null!==(n=null==i?void 0:i.user)&&void 0!==n?n:null),l(!1)});let{data:{subscription:e}}=m.auth.onAuthStateChange((e,n)=>{var i;s(n),t(null!==(i=null==n?void 0:n.user)&&void 0!==i?i:null),l(!1)});return()=>e.unsubscribe()},[m]),{user:e,session:n,loading:o,signUp:async(e,t)=>{let{data:n,error:i}=await m.auth.signUp({email:e,password:t});if(i)throw i;return n},signIn:async(e,t)=>{let{data:n,error:i}=await m.auth.signInWithPassword({email:e,password:t});if(i)throw i;return n},signOut:async()=>{let{error:e}=await m.auth.signOut();if(e)throw e;c.push("/login")},isAuthenticated:!!e}}},15:function(e,t,n){"use strict";n.d(t,{default:function(){return u}});var i=n(7437),r=n(2265),a=n(9376);async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;return new Promise((n,i)=>{let r=new Image;if(r.onload=()=>{try{let e=r.width,i=r.height;(e>t||i>t)&&(e>i?(i=i*t/e,e=t):(e=e*t/i,i=t));let a=document.createElement("canvas");a.width=e,a.height=i;let s=a.getContext("2d");if(!s)throw Error("Failed to get canvas context");s.drawImage(r,0,0,e,i);let o=a.toDataURL("image/jpeg",.85);n({dataUrl:o,width:Math.round(e),height:Math.round(i),mimeType:"image/jpeg"})}catch(e){i(Error("Failed to resize image"))}},r.onerror=()=>{i(Error("Failed to load image"))},"string"==typeof e)r.src=e;else{let t=new FileReader;t.onload=e=>{var t;r.src=null===(t=e.target)||void 0===t?void 0:t.result},t.onerror=()=>i(Error("Failed to read file")),t.readAsDataURL(e)}})}async function o(e){return e.includes(",")?e.split(",")[1]:e}var l=n(6413);function c(){let e="AIzaSyBdo07rS93Q-PloT3WWmFGAitzrwcBtxs4";return e||console.warn("NEXT_PUBLIC_GEMINI_API_KEY is not set. Please add it to your .env.local file."),e}async function m(e){var t,n,i,r,a,s,o,m,u;let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg";if(!c())throw Error("Gemini API key is not configured");try{let m=function(){let e=c();return new l.fA({apiKey:e})}(),u=await m.models.generateContent({model:"gemini-2.0-flash-exp",contents:[{inlineData:{mimeType:d,data:e}},{text:'Analyze this food image and provide detailed nutritional information including vitamins and minerals.\n\nReturn ONLY a valid JSON object with this exact structure (no markdown, no code blocks, just the JSON):\n{\n  "meal_type": "breakfast" | "lunch" | "dinner" | "snack",\n  "food_items": ["item1", "item2", ...],\n  "description": "brief description of the meal",\n  "calories": number,\n  "protein": number,\n  "carbohydrates": number,\n  "fat": number,\n  "fiber": number,\n  "sugar": number,\n  "sodium": number,\n  "vitamins": {\n    "vitaminA": number (mcg RAE),\n    "vitaminB1": number (mg),\n    "vitaminB2": number (mg),\n    "vitaminB3": number (mg),\n    "vitaminB6": number (mg),\n    "vitaminB12": number (mcg),\n    "vitaminC": number (mg),\n    "vitaminD": number (mcg),\n    "vitaminE": number (mg),\n    "vitaminK": number (mcg),\n    "folate": number (mcg)\n  },\n  "minerals": {\n    "calcium": number (mg),\n    "iron": number (mg),\n    "magnesium": number (mg),\n    "phosphorus": number (mg),\n    "potassium": number (mg),\n    "zinc": number (mg),\n    "copper": number (mg),\n    "manganese": number (mg),\n    "selenium": number (mcg)\n  }\n}\n\nUnits: grams for macros, milligrams (mg) for most minerals and some vitamins, micrograms (mcg) for trace vitamins/minerals, kcal for calories.\nIf you cannot determine a value, use null for that field. Only include vitamins and minerals that are present in significant amounts.\nBe as accurate as possible with your estimates.'}]});if(!u.text)throw Error("No response text received from Gemini API");let g=u.text.trim(),h=g;if(g.includes("```")){let e=g.match(/```(?:json)?\s*(\{[\s\S]*?\})\s*```/);if(e)h=e[1];else{let e=g.match(/\{[\s\S]*\}/);e&&(h=e[0])}}else{let e=g.match(/\{[\s\S]*\}/);e&&(h=e[0])}let f=JSON.parse(h);return{meal_type:f.meal_type||void 0,food_items:f.food_items||[],description:f.description||void 0,calories:null!==(t=f.calories)&&void 0!==t?t:void 0,protein:null!==(n=f.protein)&&void 0!==n?n:void 0,carbohydrates:null!==(i=f.carbohydrates)&&void 0!==i?i:void 0,fat:null!==(r=f.fat)&&void 0!==r?r:void 0,fiber:null!==(a=f.fiber)&&void 0!==a?a:void 0,sugar:null!==(s=f.sugar)&&void 0!==s?s:void 0,sodium:null!==(o=f.sodium)&&void 0!==o?o:void 0,vitamins:f.vitamins||void 0,minerals:f.minerals||void 0}}catch(e){if(console.error("Error analyzing food with Gemini:",e),null===(m=e.message)||void 0===m?void 0:m.includes("API key"))throw Error("Invalid or missing Gemini API key");if(null===(u=e.message)||void 0===u?void 0:u.includes("JSON"))throw Error("Failed to parse nutritional data from API response");throw Error("Failed to analyze food: ".concat(e.message||"Unknown error"))}}function u(){let e=(0,a.useRouter)(),t=(0,r.useRef)(null),n=(0,r.useRef)(null),[l,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(null),[g,h]=(0,r.useState)("environment");(0,r.useEffect)(()=>(f(),()=>{b()}),[g]);let f=async()=>{try{b();let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:g}});t.current&&(t.current.srcObject=e,n.current=e,d(null))}catch(e){console.error("Error accessing camera:",e),d("Unable to access camera. Please grant camera permissions.")}},b=()=>{n.current&&(n.current.getTracks().forEach(e=>e.stop()),n.current=null)},v=async()=>{if(t.current)try{c(!0),d(null);let e=document.createElement("canvas");e.width=t.current.videoWidth,e.height=t.current.videoHeight;let n=e.getContext("2d");if(!n)throw Error("Failed to get canvas context");n.drawImage(t.current,0,0),e.toBlob(async t=>{if(!t)throw Error("Failed to capture image");let n=new File([t],"photo.jpg",{type:"image/jpeg"});await y(n,e.toDataURL("image/jpeg"))},"image/jpeg",.9)}catch(e){console.error("Error capturing photo:",e),d("Failed to capture photo. Please try again."),c(!1)}},p=async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(n){c(!0),d(null);let e=new FileReader;e.onload=async e=>{var t;let i=null===(t=e.target)||void 0===t?void 0:t.result;await y(n,i)},e.onerror=()=>{d("Failed to read file"),c(!1)},e.readAsDataURL(n)}},y=async(t,n)=>{try{let i=await s(t,1024),r=await o(i.dataUrl),a=await m(r,i.mimeType),l={imageUri:n,dateTime:new Date,nutritionalData:a};sessionStorage.setItem("analysisResult",JSON.stringify(l));let c=await fetch(n),u=await c.blob();new File([u],"food-photo.jpg",{type:"image/jpeg"}),sessionStorage.setItem("analysisImageFile",JSON.stringify({dataUrl:n,name:"food-photo.jpg",type:"image/jpeg"})),e.push("/results")}catch(e){console.error("Error processing image:",e),d(e.message||"Failed to analyze food image. Please try again.")}finally{c(!1)}};return l?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-white p-8",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"}),(0,i.jsx)("p",{className:"text-lg font-semibold text-gray-800",children:"Analyzing food..."}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"This may take a few seconds"})]}):(0,i.jsxs)("div",{className:"flex flex-col min-h-screen bg-black",children:[(0,i.jsxs)("div",{className:"flex-1 relative",children:[(0,i.jsx)("video",{ref:t,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,i.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-between",children:[(0,i.jsx)("div",{className:"bg-black bg-opacity-50 p-6 pt-16 text-center",children:(0,i.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Food Nutrition Analyzer"})}),(0,i.jsx)("div",{className:"bg-black bg-opacity-50 p-8 pb-12",children:(0,i.jsxs)("div",{className:"flex justify-around items-center",children:[(0,i.jsxs)("label",{className:"px-4 py-2 rounded-lg bg-white bg-opacity-20 text-white cursor-pointer hover:bg-opacity-30 transition",children:[(0,i.jsx)("span",{className:"text-sm font-semibold",children:"Gallery"}),(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:p,className:"hidden"})]}),(0,i.jsx)("button",{onClick:v,className:"w-20 h-20 rounded-full bg-white border-4 border-blue-500 flex items-center justify-center hover:scale-105 transition",disabled:l,children:(0,i.jsx)("div",{className:"w-15 h-15 rounded-full bg-blue-500"})}),(0,i.jsx)("button",{onClick:()=>{h(e=>"user"===e?"environment":"user")},className:"px-4 py-2 rounded-lg bg-white bg-opacity-20 text-white hover:bg-opacity-30 transition",children:(0,i.jsx)("span",{className:"text-sm font-semibold",children:"Flip"})})]})})]})]}),u&&(0,i.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 m-4 rounded",children:[(0,i.jsx)("p",{children:u}),(0,i.jsx)("button",{onClick:()=>d(null),className:"mt-2 text-sm underline",children:"Dismiss"})]})]})}}},function(e){e.O(0,[19,146,971,117,744],function(){return e(e.s=846)}),_N_E=e.O()}]);